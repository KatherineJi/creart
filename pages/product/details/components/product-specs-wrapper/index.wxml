<view class="product-specs-wrapper">
  <view class="popup-container">
    <view wx:if="{{!fromPreview}}" class="popup-close" bindtap="handlePopupHide">
      <t-icon name="close" size="36rpx" />
    </view>
    <view class="popup-sku-header">
      <t-image t-class="popup-sku-header__img" src="{{specImg || product.preview_imgs[0]}}" />
      <view class="popup-sku-header__product-info">
        <view class="popup-sku__product-name">{{product.name || ''}}</view>
        <view class="product-price-container">
          <!-- <slot name="product-price" /> -->
          <view class="popup-sku__price">
            <price
              wx:if="{{!isAllSelectedSku || (!promotionSubCode && isAllSelectedSku)}}"
              price="{{selectSkuSellsPrice ? selectSkuSellsPrice : product.minSalePrice }}"
              priceUnit="fen"
              wr-class="popup-sku__price-num"
              symbol-class="popup-sku__price-symbol" />
            <price
              wx:if="{{selectSkuSellsPrice === 0 && product.minSalePrice !== product.maxSalePrice && !isAllSelectedSku}}"
              price="{{product.maxSalePrice}}"
              priceUnit="fen"
              wr-class="popup-sku__price-del"
              type="delthrough" />
          </view>
        </view>
        <!-- 已选规格 -->
        <view class="popup-sku__selected-spec" wx:if="{{specList.length > 0}}">
          <view>选择：</view>
          <view wx:for="{{specList}}" wx:key="specId">
            <view
              class="popup-sku__selected-item"
              wx:for="{{item.specValueList}}"
              wx:for-item="selectedItem"
              wx:if="{{selectedItem.isSelected}}"
              wx:key="specValueId">
              {{selectedItem.specValue}}
            </view>
          </view>
        </view>
      </view>
    </view>
    <view class="popup-sku-body">
      <view class="popup-sku-group-container">
        <view class="popup-sku-row" wx:for="{{specList}}" wx:key="specId">
          <view class="popup-sku-row__title">{{item.title}}</view>
          <block
            wx:for="{{item.specValueList}}"
            wx:for-item="valuesItem"
            wx:for-index="valuesIndex"
            wx:key="specValueId">
            <view
              class="popup-sku-row__item {{valuesItem.isSelected ? 'popup-sku-row__item--active' : ''}} {{!valuesItem.hasStockObj.hasStock || !isStock ? 'disabled-sku-selected' : ''}}"
              data-specid="{{item.specId}}"
              data-id="{{valuesItem.specValueId}}"
              data-val="{{valuesItem.specValue}}"
              data-hasStock="{{valuesItem.hasStockObj.hasStock}}"
              bindtap="toChooseItem">
              {{valuesItem.specValue}}
            </view>
          </block>
        </view>
      </view>
      <view class="popup-sku-stepper-stock">
        <view class="popup-sku-stepper-container">
          <view class="popup-sku__stepper-title"> 购买数量 <view class="limit-text" wx:if="{{limitBuyInfo}}">
              ({{limitBuyInfo}}) </view>
          </view>
          <t-stepper value="{{buyNum}}" min="{{1}}" max="{{2}}" theme="filled" bind:change="handleBuyNumChange" />
        </view>
      </view>
    </view>
    <view wx:if="{{true}}" class="single-confirm-btn {{!isStock ? 'disabled' : ''}}" bindtap="specsConfirm"> {{ fromPreview ? '立即购买' : '选择图片' }}
    </view>
    <view
      class="popup-sku-actions flex flex-between {{!isStock ? 'popup-sku-disabled' : ''}}"
      wx:if="{{!outOperateStatus && false}}">
      <view class="sku-operate">
        <view class="selected-sku-btn sku-operate-addCart {{!isStock ? 'disabled' : ''}}" bindtap="addCart"> 加入购物车
        </view>
      </view>
      <view class="sku-operate">
        <view class="selected-sku-btn sku-operate-buyNow  {{!isStock ? 'disabled' : ''}}" bindtap="buyNow"> 立即购买 </view>
      </view>
    </view>
    <slot name="bottomSlot" />
  </view>
</view>
<t-toast id="t-toast" />